{{ config(
    indexes = [{'columns':['_airbyte_emitted_at'],'type':'btree'}],
    unique_key = '_airbyte_ab_id',
    schema = "_airbyte_halcapitaldb",
    tags = [ "top-level-intermediate" ]
) }}
-- SQL model to parse JSON blob stored in a single column and extract into separated field columns as described by the JSON Schema
-- depends_on: {{ source('halcapitaldb', '_airbyte_raw_users') }}
select
    {{ json_extract_scalar('_airbyte_data', ['_id'], ['_id']) }} as _id,
    {{ json_extract_scalar('_airbyte_data', ['dob'], ['dob']) }} as dob,
    {{ json_extract_scalar('_airbyte_data', ['name'], ['name']) }} as {{ adapter.quote('name') }},
    {{ json_extract_scalar('_airbyte_data', ['email'], ['email']) }} as email,
    {{ json_extract_scalar('_airbyte_data', ['county'], ['county']) }} as county,
    {{ json_extract_scalar('_airbyte_data', ['status'], ['status']) }} as status,
    {{ json_extract_scalar('_airbyte_data', ['address'], ['address']) }} as address,
    {{ json_extract_scalar('_airbyte_data', ['country'], ['country']) }} as country,
    {{ json_extract_scalar('_airbyte_data', ['partner'], ['partner']) }} as partner,
    {{ json_extract_scalar('_airbyte_data', ['website'], ['website']) }} as website,
    {{ json_extract_scalar('_airbyte_data', ['dukareId'], ['dukareId']) }} as dukareid,
    {{ json_extract_scalar('_airbyte_data', ['latitude'], ['latitude']) }} as latitude,
    {{ json_extract_scalar('_airbyte_data', ['premises'], ['premises']) }} as premises,
    {{ json_extract_scalar('_airbyte_data', ['settings'], ['settings']) }} as settings,
    {{ json_extract_scalar('_airbyte_data', ['userType'], ['userType']) }} as usertype,
    {{ json_extract_scalar('_airbyte_data', ['cognitoId'], ['cognitoId']) }} as cognitoid,
    {{ json_extract_scalar('_airbyte_data', ['createdAt'], ['createdAt']) }} as createdat,
    {{ json_extract_scalar('_airbyte_data', ['lastLogin'], ['lastLogin']) }} as lastlogin,
    {{ json_extract_scalar('_airbyte_data', ['longitude'], ['longitude']) }} as longitude,
    {{ json_extract_scalar('_airbyte_data', ['pinNumber'], ['pinNumber']) }} as pinnumber,
    {{ json_extract_scalar('_airbyte_data', ['updatedAt'], ['updatedAt']) }} as updatedat,
    {{ json_extract_scalar('_airbyte_data', ['updatedBy'], ['updatedBy']) }} as updatedby,
    {{ json_extract_scalar('_airbyte_data', ['employment'], ['employment']) }} as employment,
    {{ json_extract_scalar('_airbyte_data', ['isVerified'], ['isVerified']) }} as isverified,
    {{ json_extract_scalar('_airbyte_data', ['nationalId'], ['nationalId']) }} as nationalid,
    {{ json_extract_scalar('_airbyte_data', ['noOfOrders'], ['noOfOrders']) }} as nooforders,
    {{ json_extract_scalar('_airbyte_data', ['postalCode'], ['postalCode']) }} as postalcode,
    {{ json_extract_scalar('_airbyte_data', ['erpUserCode'], ['erpUserCode']) }} as erpusercode,
    {{ json_extract_scalar('_airbyte_data', ['phoneNumber'], ['phoneNumber']) }} as phonenumber,
    {{ json_extract_scalar('_airbyte_data', ['businessName'], ['businessName']) }} as businessname,
    {{ json_extract_scalar('_airbyte_data', ['businessType'], ['businessType']) }} as businesstype,
    {{ json_extract_scalar('_airbyte_data', ['constituency'], ['constituency']) }} as constituency,
    {{ json_extract_scalar('_airbyte_data', ['dukaUserType'], ['dukaUserType']) }} as dukausertype,
    {{ json_extract_scalar('_airbyte_data', ['incomeBizAvg'], ['incomeBizAvg']) }} as incomebizavg,
    {{ json_extract_scalar('_airbyte_data', ['pinImagePath'], ['pinImagePath']) }} as pinimagepath,
    {{ json_extract_scalar('_airbyte_data', ['profileImage'], ['profileImage']) }} as profileimage,
    {{ json_extract_scalar('_airbyte_data', ['salesRepName'], ['salesRepName']) }} as salesrepname,
    {{ json_extract_scalar('_airbyte_data', ['accommodation'], ['accommodation']) }} as accommodation,
    {{ json_extract_scalar('_airbyte_data', ['businessImage'], ['businessImage']) }} as businessimage,
    {{ json_extract_scalar('_airbyte_data', ['monthlyIncome'], ['monthlyIncome']) }} as monthlyincome,
    {{ json_extract_scalar('_airbyte_data', ['noOfEmployees'], ['noOfEmployees']) }} as noofemployees,
    {{ json_extract_scalar('_airbyte_data', ['noOfSuppliers'], ['noOfSuppliers']) }} as noofsuppliers,
    {{ json_extract_scalar('_airbyte_data', ['orderPriceAvg'], ['orderPriceAvg']) }} as orderpriceavg,
    {{ json_extract_scalar('_airbyte_data', ['monthlyRentBiz'], ['monthlyRentBiz']) }} as monthlyrentbiz,
    {{ json_extract_scalar('_airbyte_data', ['outstandingLoan'], ['outstandingLoan']) }} as outstandingloan,
    {{ json_extract_scalar('_airbyte_data', ['salesRepCompany'], ['salesRepCompany']) }} as salesrepcompany,
    {{ json_extract_scalar('_airbyte_data', ['yearOfOperation'], ['yearOfOperation']) }} as yearofoperation,
    {{ json_extract_scalar('_airbyte_data', ['isAccountVerified'], ['isAccountVerified']) }} as isaccountverified,
    {{ json_extract_scalar('_airbyte_data', ['monthlySalariesBiz'], ['monthlySalariesBiz']) }} as monthlysalariesbiz,
    {{ json_extract_scalar('_airbyte_data', ['nationalIdImagePath'], ['nationalIdImagePath']) }} as nationalidimagepath,
    {{ json_extract_scalar('_airbyte_data', ['salesRepPhoneNumber'], ['salesRepPhoneNumber']) }} as salesrepphonenumber,
    {{ json_extract_scalar('_airbyte_data', ['loanOutstandingPeriod'], ['loanOutstandingPeriod']) }} as loanoutstandingperiod,
    {{ json_extract_scalar('_airbyte_data', ['costOfmonthlyUtilities'], ['costOfmonthlyUtilities']) }} as costofmonthlyutilities,
    {{ json_extract_scalar('_airbyte_data', ['supplierCreditFacility'], ['supplierCreditFacility']) }} as suppliercreditfacility,
    {{ json_extract_scalar('_airbyte_data', ['businessRegistrationNumber'], ['businessRegistrationNumber']) }} as businessregistrationnumber,
    {{ json_extract_scalar('_airbyte_data', ['businessRegistrationNumberImagePath'], ['businessRegistrationNumberImagePath']) }} as businessregistrationnumberimagepath,
    _airbyte_ab_id,
    _airbyte_emitted_at,
    {{ current_timestamp() }} as _airbyte_normalized_at
from {{ source('halcapitaldb', '_airbyte_raw_users') }} as table_alias
-- users
where 1 = 1
{{ incremental_clause('_airbyte_emitted_at') }}

